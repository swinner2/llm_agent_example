<turbo-frame id="message_<%= message.id %>">
  <div data-controller="scroll-into-view">
    <% if message.role == "assistant" %>
      <div class="flex items-start mb-4">
        <div class="bg-gray-100 rounded-lg px-4 py-2 max-w-[80%]">
          <% if message.content.present? %>
            <p class="text-gray-800 prose"><%= message.content.html_safe %></p>
          <% else %>
            <p class="text-gray-800 animate-bounce">Typing...</p>
          <% end %>
        </div>
      </div>
    <% elsif message.role == "user" %>
      <div class="flex items-start justify-end mb-4">
        <div class="bg-blue-500 text-white rounded-lg px-4 py-2 max-w-[80%]">
          <p class="text-white prose"><%= message.content.html_safe %></p>
        </div>
      </div>
    <% elsif message.role == "tool" %>
      <div class="flex items-start mb-4">
        <div class="bg-green-100 border border-green-300 rounded-lg px-4 py-2 max-w-[80%]">
          <div class="text-xs font-semibold text-green-700 mb-1">
            Tool: <%= message.data["name"] %>
          </div>
          <% if message.data["name"] == "generate_image" && message.content.present? %>
            <% begin %>
              <% image_data = JSON.parse(message.content) %>
              <% if image_data["url"].present? %>
                <img src="<%= image_data["url"] %>" alt="Generated image" class="max-w-full rounded my-2" />
              <% end %>
            <% rescue JSON::ParserError %>
              <p class="text-gray-800"><%= message.content %></p>
            <% end %>
          <% else %>
            <p class="text-gray-800"><%= message.content %></p>
          <% end %>
        </div>
      </div>
    <% end %>
</div>